package io.edukativ.myskoolin.domain.timetabling.constraints;
    dialect "java"

import io.edukativ.myskoolin.domain.timetabling.Lesson;
import io.edukativ.myskoolin.domain.timetabling.TimeSlot;
import io.edukativ.myskoolin.domain.timetabling.SchoolClassTimeTable;
import io.edukativ.myskoolin.domain.subjects.Subject;
import org.optaplanner.core.api.score.buildin.hardmediumsoft.HardMediumSoftScoreHolder;
import java.util.List

global HardMediumSoftScoreHolder scoreHolder;

//----------------------------------------------------------------------------------------------------------

rule "Subject duration max by day"
when
  $lesson : Lesson()
  $total : Integer() from
     accumulate ( Lesson($timeslot: timeSlot, subject == $lesson.subject, timeSlot.day == $lesson.timeSlot.day) ,
            init( int total =0;),
            action(total+=($timeslot.durationInMinutes());),
            result( new Integer (total)))
then
  System.out.println(
          " Subject : "+ $lesson.getSubject().getName() +
          " \nTotal duration : " + $total +
          " \nMax duration : " + $lesson.getSubject().getMaxMinutesPerDay() +
          " \nGap : " + $lesson.getSubject().maxMinutesPerDayPenalty($total.intValue())
                     );
        scoreHolder.penalize(kcontext, $lesson.getSubject().maxMinutesPerDayPenalty($total.intValue()));
end

//----------------------------------------------------------------------------------------------------------

rule "Time slot overlapping another time slot"
when
  $timeslot1: TimeSlot()
  $lesson : Lesson($timeslot2: timeSlot, $timeslot2 != $timeslot1, $timeslot1.isOverlapping($timeslot2))
then
  scoreHolder.penalize(kcontext, $timeslot1.overlappingGap($timeslot2).intValue() /2);
end

//----------------------------------------------------------------------------------------------------------

rule "School room right type"
    when
        $lesson: Lesson(!hasRightSchoolRoomType())
    then
        scoreHolder.penalize(kcontext, $lesson.getTimeSlot().durationInMinutes().intValue());
end

//----------------------------------------------------------------------------------------------------------
